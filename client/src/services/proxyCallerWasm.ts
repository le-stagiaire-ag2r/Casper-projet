/**
 * Embedded proxy_caller wasm files as base64
 * This bypasses Vercel's file serving issues
 */

// proxy_caller.wasm - for functions WITHOUT return values (stake, claim, etc.)
const PROXY_CALLER_WASM_BASE64 = "AGFzbQEAAAABoAEWYAJ/fwF/YAJ/fwBgA39/fwBgAX8AYAN/f38Bf2ABfwF/YAR/f39/AGAFf39/f38AYAR/f39/AX9gBX9/f39/AX9gAABgAn9/AX5gCX9/f39/f39/fwF/YAh/f39/f39/fwF/YAV/f39+fgF/YAN/fn4AYAJ/fgBgAn9+AX9gBH9/fn4AYAd/f39/f39/AGAGf39/f39/AX9gA35/fwF/AsoCDANlbnYNY2FzcGVyX3JldmVydAADA2Vudg9jYXNwZXJfbmV3X3VyZWYAAgNlbnYMY2FzcGVyX3dyaXRlAAYDZW52FGNhc3Blcl9nZXRfbmFtZWRfYXJnAAgDZW52HmNhc3Blcl9jYWxsX3ZlcnNpb25lZF9jb250cmFjdAAMA2VudhdjYXNwZXJfcmVhZF9ob3N0X2J1ZmZlcgAEA2VudhljYXNwZXJfZ2V0X25hbWVkX2FyZ19zaXplAAQDZW52DmNhc3Blcl9nZXRfa2V5AAkDZW52FWNhc3Blcl9nZXRfbWFpbl9wdXJzZQADA2VudhNjYXNwZXJfY3JlYXRlX3B1cnNlAAADZW52EmNhc3Blcl9nZXRfYmFsYW5jZQAEA2VudiNjYXNwZXJfdHJhbnNmZXJfZnJvbV9wdXJzZV90b19wdXJzZQANA4oBiAEDBQUKAQMDBQUGAwMHAwACCAMCAgIBAwMBDgUPBQYCAwEDBQAGBwEBAgMBAgEAAgMDAwACAQEBAgIBAgMCAQIAAQIBAgECAAYBAwMFBQUFBQABAgABAQECAgYCAwMDAQAABQEHAQYBBQALEBEBEgALAgIAAQoBAQEDAQIEAgAEAgMCAAITAAAUAAAJBAAVBAQEBAQFAXABGxsFAwEAEQYZA38BQYCAwAALfwBBoJjAAAt/AEGcmMAACwcsBAZtZW1vcnkCAARjYWxsABALX19oZWFwX2Jhc2UDAQpfX2RhdGFfZW5kAwIJJgEAQQELGkNhRF5VXY0Bc2t/dGx9dXZngAF2d3h5eokBjgGQAZEBCsjvApABCQAgABBSEAAACxYAIABBGHRBGHVBAnRBiIDAAGooAgALBgAgABBRC70LAg1/A34jAEGgA2siACQAIABBCGoQFiAAQZgCaiAAQdgAaikDADcDACAAQZACaiAAQdAAaikDADcDACAAQYACakEIaiAAQcgAaikDADcDACAAIAApA0A3A4ACIAAoAmQhASAAKAJoIQIgAEGAAWpBCGogAEH0AGooAgA2AgAgACAAKQJsNwOAASAAQfQAaiAAQYACaiABIAIgAEGAAWoQFyAAQQhqEBggACgCfCEDIAAoAnghAiAAKAJ0IQQgAEGAAWpBgIDAAEEIEB4CQAJAAkACQAJAAkACQCAAKAKAASIFQQJGDQACQCAFQRlHDQBBIRAlIQUgAEGAAmogAiADEFoCQCAERQ0AIAIgBEEBEBoLIAAtAIQCIQIgACgCgAIiBEGAgICAeEYNAyAAIAAoAIUCNgLYAiAAIABBgAJqQQhqKAAANgDbAiAAQdwBahA+IABB7AFqIgMgBDYCACAAQfQBaiIEIAAoANsCNgAAIABB+AJqQQhqIABB5AFqKQIANwMAIAAgAjoA8AEgACAAKALYAjYA8QEgAEGIA2ogAykCADcDACAAQZADaiAEKAIANgIAIAAgACkC3AE3A4ADIABB8AFqIABBgANqEDkgACgC8AEiBEGAgICAeEYNBCAFIAAoAvQBIgYgACgC+AEQASAAQYACaiAFQSEQSCAALQCAAiEDAkACQCAAKAKkAkUNACAAQfcBaiAAQaACaigAADYAACAAQdgBakEYaiICIABBmQJqKQAANwMAIABB2AFqQRBqIgcgAEGRAmopAAAiDTcDACAAQdgBakEIaiIIIABBiQJqKQAAIg43AwAgACAAKQCBAiIPNwPYASAAKAKoAiEJIABBgAJqQRhqIgogAikDADcDACAAQYACakEQaiILIA03AwAgAEGAAmpBCGoiDCAONwMAIAAgDzcDgAIgCUUNAUECIQMLIAVBIUEBEBogAxAMEAsACyACIAopAwA3AwAgByALKQMANwMAIAggDCkDADcDACAAIAApA4ACNwPYASAFQSFBARAaAkAgBEUNACAGIARBARAaCyAAQZECaiAAQdgBakEIaikDADcAACAAQZkCaiAAQegBaikDADcAACAAQYACakEhaiAAQfABaikDADcAACAAIAM6AIgCIAAgACkD2AE3AIkCIABBAjYCgAJBgIDAAEEIIABBgAJqEB8MAgtBCBALAAsgAC0AiAEhBSAAKACJASEJIABBgAJqQRVqIABBgAFqQRVqKQAANwAAIABBgAJqQR1qIABBgAFqQR1qKQAANwAAIABBgAJqQSVqIABBgAFqQSVqKAAANgAAIAAgCTYAiQIgACAFOgCIAiAAIAApAI0BNwCNAiAAQQI2AoACIABB2AFqIABBgAJqEFQgACgC2AEiBUGAgICAeEYNAyAAKALgASEHIAAoAtwBIQkgAEHYAWogAiADEFoCQCAERQ0AIAIgBEEBEBoLIAAtANwBIQIgACgC2AEiBEGAgICAeEYNBCAAIAAoAN0BNgKYAyAAIABB2AFqQQhqKAAANgCbAyAAQfwCahA+IABBjANqIgMgBDYCACAAQZQDaiIEIAAoAJsDNgAAIABB2AJqQQhqIABBhANqKQIANwMAIAAgAjoAkAMgACAAKAKYAzYAkQMgAEHoAmogAykCADcDACAAQfACaiAEKAIANgIAIAAgACkC/AI3A+ACIABB2AFqIABB4AJqEDkgACgC2AEiAkGAgICAeEYNBSAJIAcgACgC3AEiBCAAKALgARACAkAgAkUNACAEIAJBARAaCyAFRQ0AIAkgBUEBEBoLAkAgACgCYCICRQ0AIAEgAkEBEBoLIABBoANqJAAPCyAAIAI6ANwBIABBFzYC2AEgAEGAAmpBGGogAEHYAWpBGGopAgA3AwAgAEGAAmpBEGogAEHYAWpBEGopAgA3AwAgAEGAAmpBCGogAEHYAWpBCGopAgA3AwAgACAAKQLYATcDgAIgAEGAAmogAEGQAWoQQBAPEAsACyAALQCEAhAMEAsACyAALQDcARAMEAsACyAAIAI6APwCIABBFzYC+AIgAEHYAWpBGGogAEH4AmpBGGopAgA3AwAgAEHYAWpBEGogAEH4AmpBEGopAgA3AwAgAEHYAWpBCGogAEH4AmpBCGopAgA3AwAgACAAKQL4AjcD2AEgAEHYAWogAEGAAWoQQBAPEAsACyAALQDcARAMEAsACwoAIAAgARB6DwsJACAAEFIQAAALiwEBBH8CQCAAKAIAIgFBFUsNAEEEIQICQAJAQQEgAXQiA0GAgCNxRQ0AQQQhBAwBC0EIIQQCQCADQYCA2ABxDQAgAUEVRw0CIAAoAgQiARARIAFBEEEEEBpBDCEEQQghAgsgACACaigCACIBEBEgAUEQQQQQGgsgACAEaigCACIAEBEgAEEQQQQQGgsLFgAgAEEYdEEYdUECdEHkgMAAaigCAAsGACAAEFELwAEBAX8CQAJAAkAgAUUNACACQX9MDQECQAJAAkAgAygCBEUNAAJAIAMoAggiBA0AAkAgAg0AIAEhAwwEC0EALQCBmEAaDAILIAMoAgAgBCABIAIQGSEDDAILAkAgAg0AIAEhAwwCC0EALQCBmEAaCyACIAEQGCEDCwJAIANFDQAgACACNgIIIAAgAzYCBCAAQQA2AgAPCyAAIAI2AgggACABNgIEDAILIABBADYCBAwBCyAAQQA2AgQLIABBATYCAAvCAQEGfyMAQSBrIgEkAAJAIAAoAgAiAkF/Rw0AQQBBABBzAQALQQAhAyACQQF0IAJBAWogAkEAShsiBEEEIARBBEsbIgVBKGwhBiAEQbTmzBlJQQJ0IQQCQCACRQ0AIAEgAkEobDYCHCABIAAoAgQ2AhRBBCEDCyABIAM2AhggAUEIaiAEIAYgAUEUahAUIAEoAgghAwJAIAENACABKAIMIAEoAhAQcwEACyABKAIMIQIgACAFNgIAIAAgAjYCBCABQSBqJAAL";

// proxy_caller_with_return.wasm - for functions WITH return values (request_unstake)
const PROXY_CALLER_WITH_RETURN_WASM_BASE64 = "AGFzbQEAAAABoAEWYAJ/fwF/YAJ/fwBgA39/fwBgAX8AYAN/f38Bf2ABfwF/YAR/f39/AGAFf39/f38AYAR/f39/AX9gBX9/f39/AX9gAABgAn9/AX5gCX9/f39/f39/fwF/YAh/f39/f39/fwF/YAV/f39+fgF/YAN/fn4AYAJ/fgBgAn9+AX9gBH9/fn4AYAd/f39/f39/AGAGf39/f39/AX9gA35/fwF/At8CDQNlbnYNY2FzcGVyX3JldmVydAADA2Vudg9jYXNwZXJfbmV3X3VyZWYAAgNlbnYMY2FzcGVyX3dyaXRlAAYDZW52FGNhc3Blcl9nZXRfbmFtZWRfYXJnAAgDZW52HmNhc3Blcl9jYWxsX3ZlcnNpb25lZF9jb250cmFjdAAMA2VudhdjYXNwZXJfcmVhZF9ob3N0X2J1ZmZlcgAEA2VudhljYXNwZXJfZ2V0X25hbWVkX2FyZ19zaXplAAQDZW52DmNhc3Blcl9nZXRfa2V5AAkDZW52DmNhc3Blcl9wdXRfa2V5AAYDZW52FWNhc3Blcl9nZXRfbWFpbl9wdXJzZQADA2VudhNjYXNwZXJfY3JlYXRlX3B1cnNlAAADZW52EmNhc3Blcl9nZXRfYmFsYW5jZQAEA2VudiNjYXNwZXJfdHJhbnNmZXJfZnJvbV9wdXJzZV90b19wdXJzZQANA5QBkgEDBQUKAQMDBQUGAwMHAwACCAMCAgIBAwMBDgUPBQYCAwEDBQAGBwEBAgMBAgEAAgMDAwACAQEBAgIBAgMCAQIAAQIBAgECAAYBAwMFBQUFBQABAgABAQECAgYCAwMDAQAABQEHAQYBBQALEBEBEgALAgIAAQoBAQEDAQIEAgAEAgMCAAITAAAUAAAJBAAVBAQEBAQFAXABGxsFAwEAEQYZA38BQYCAwAALfwBBoJjAAAt/AEGcmMAACwcsBAZtZW1vcnkCAARjYWxsABALX19oZWFwX2Jhc2UDAQpfX2RhdGFfZW5kAwIJJgEAQQELGlNyVG9YVW2VAXN7f3R8fX51gAF2d3h5eooBjwGSAZMBCpT+ApIBCQAgABBaEAAACxYAIABBGHRBGHVBAnRBiIDAAGooAgALBgAgABBZC/UMAg1/A34jAEGwA2siACQAIABBCGoQGCAAQagCaiAAQeAAaikDADcDACAAQaACaiAAQdgAaikDADcDACAAQZACakEIaiAAQdAAaikDADcDACAAIAApA0g3A5ACIAAoAmwhASAAKAJwIQIgAEGQAWpBCGogAEH8AGooAgA2AgAgACAAKQJ0NwOQASAAQYQBaiAAQZACaiABIAIgAEGQAWoQGSAAQQhqEBogACgCjAEhAyAAKAKIASECIAAoAoQBIQQgAEGQAWpBgIDAAEEIECACQAJAAkACQAJAAkACQCAAKAKQASIFQQJGDQACQCAFQRlHDQBBIRAnIQUgAEGQAmogAiADEGQCQCAERQ0AIAIgBEEBEBwLIAAtAJQCIQIgACgCkAIiBEGAgICAeEYNAyAAIAAoAJUCNgLoAiAAIABBkAJqQQhqKAAANgDrAiAAQewBahBIIABB/AFqIgMgBDYCACAAQYQCaiIEIAAoAOsCNgAAIABBiANqQQhqIABB9AFqKQIANwMAIAAgAjoAgAIgACAAKALoAjYAgQIgAEGYA2ogAykCADcDACAAQaADaiAEKAIANgIAIAAgACkC7AE3A4gDIABBkAJqIABBiANqEEMgACgCkAIiBEGAgICAeEYNBCAFIAAoApQCIgYgACgCmAIQASAAQZACaiAFQSEQUiAALQCQAiEDAkACQCAAKAK0AkUNACAAQYcCaiAAQbACaigAADYAACAAQegBakEYaiICIABBqQJqKQAANwMAIABB6AFqQRBqIgcgAEGhAmopAAAiDTcDACAAQegBakEIaiIIIABBmQJqKQAAIg43AwAgACAAKQCRAiIPNwPoASAAKAK4AiEJIABBkAJqQRhqIgogAikDADcDACAAQZACakEQaiILIA03AwAgAEGQAmpBCGoiDCAONwMAIAAgDzcDkAIgCUUNAUECIQMLIAVBIUEBEBwgAxAOEA0ACyACIAopAwA3AwAgByALKQMANwMAIAggDCkDADcDACAAIAApA5ACNwPoASAFQSFBARAcAkAgBEUNACAGIARBARAcCyAAQaECaiAAQegBakEIaikDADcAACAAQakCaiAAQfgBaikDADcAACAAQZACakEhaiAAQYACaikDADcAACAAIAM6AJgCIAAgACkD6AE3AJkCIABBAjYCkAJBgIDAAEEIIABBkAJqECEMAgtBCBANAAsgAC0AmAEhBSAAKACZASEJIABBkAJqQRVqIABBkAFqQRVqKQAANwAAIABBkAJqQR1qIABBkAFqQR1qKQAANwAAIABBkAJqQSVqIABBkAFqQSVqKAAANgAAIAAgCTYAmQIgACAFOgCYAiAAIAApAJ0BNwCdAiAAQQI2ApACIABB6AFqIABBkAJqEF4gACgC6AEiBUGAgICAeEYNAyAAKALwASEHIAAoAuwBIQkgAEHoAWogAiADEGQCQCAERQ0AIAIgBEEBEBwLIAAtAOwBIQIgACgC6AEiBEGAgICAeEYNBCAAIAAoAO0BNgKoAyAAIABB6AFqQQhqKAAANgCrAyAAQYwDahBIIABBnANqIgMgBDYCACAAQaQDaiIEIAAoAKsDNgAAIABB6AJqQQhqIABBlANqKQIANwMAIAAgAjoAoAMgACAAKAKoAzYAoQMgAEH4AmogAykCADcDACAAQYADaiAEKAIANgIAIAAgACkCjAM3A+gCIABB6AFqIABB6AJqEEMgACgC6AEiAkGAgICAeEYNBSAJIAcgACgC7AEiBCAAKALwARACAkAgAkUNACAEIAJBARAcCyAFRQ0AIAkgBUEBEBwLAkAgACgCaCICRQ0AIAEgAkEBEBwLIABBsANqJAAPCyAAIAI6AOwBIABBFzYC6AEgAEGQAmpBGGogAEHoAWpBGGopAgA3AwAgAEGQAmpBEGogAEHoAWpBEGopAgA3AwAgAEGQAmpBCGogAEHoAWpBCGopAgA3AwAgACAAKQLoATcDkAIgAEGQAmoQDxANAAsgAC0AlAIQDhANAAsgAC0A7AEQDhANAAsgACACOgCMAyAAQRc2AogDIABB6AFqQRhqIABBiANqQRhqKQIANwMAIABB6AFqQRBqIABBiANqQRBqKQIANwMAIABB6AFqQQhqIABBiANqQQhqKQIANwMAIAAgACkCiAM3A+gBIABB6AFqEA8QDQALIAAtAOwBEA4QDQALCgAgACABEIQBDwsJACAAEFoQAAALiwEBBH8CQCAAKAIAIgFBFUsNAEEEIQICQAJAQQEgAXQiA0GAgCNxRQ0AQQQhBAwBC0EIIQQCQCADQYCA2ABxDQAgAUEVRw0CIAAoAgQiARATIAFBEEEEEBxBDCEEQQghAgsgACACaigCACIBEBMgAUEQQQQQHAsgACAEaigCACIAEBMgAEEQQQQQHAsLFgAgAEEYdEEYdUECdEHkgMAAaigCAAsGACAAEFkLwAEBAX8CQAJAAkAgAUUNACACQX9MDQECQAJAAkAgAygCBEUNAAJAIAMoAggiBA0AAkAgAg0AIAEhAwwEC0EALQCBmEAaDAILIAMoAgAgBCABIAIQHSEDDAILAkAgAg0AIAEhAwwCC0EALQCBmEAaCyACIAEQGyEDCwJAIANFDQAgACACNgIIIAAgAzYCBCAAQQA2AgAPCyAAIAI2AgggACABNgIEDAILIABBADYCBAwBCyAAQQA2AgQLIABBATYCAAvCAQEGfyMAQSBrIgEkAAJAIAAoAgAiAkF/Rw0AQQBBABCCAQALQQAhAyACQQF0IAJBAWogAkEAShsiBEEEIARBBEsbIgVBKGwhBiAEQbTmzBlJQQJ0IQQCQCACRQ0AIAEgAkEobDYCHCABIAAoAgQ2AhRBBCEDCyABIAM2AhggAUEIaiAEIAYgAUEUahAWAkAgASgCCEUNACABKAIMIAEoAhAQggEACyABKAIMIQIgACAFNgIAIAAgAjYCBCABQSBqJAAL";

/**
 * Decode base64 to Uint8Array
 */
function base64ToUint8Array(base64: string): Uint8Array {
  const binaryString = atob(base64);
  const bytes = new Uint8Array(binaryString.length);
  for (let i = 0; i < binaryString.length; i++) {
    bytes[i] = binaryString.charCodeAt(i);
  }
  return bytes;
}

// Cached decoded wasm
let proxyCallerWasmCache: Uint8Array | null = null;
let proxyCallerWithReturnWasmCache: Uint8Array | null = null;

/**
 * Get proxy_caller.wasm bytes (for functions WITHOUT return values)
 */
export function getProxyCallerWasm(): Uint8Array {
  if (!proxyCallerWasmCache) {
    proxyCallerWasmCache = base64ToUint8Array(PROXY_CALLER_WASM_BASE64);
    console.log('Decoded proxy_caller.wasm:', proxyCallerWasmCache.length, 'bytes');
  }
  return proxyCallerWasmCache;
}

/**
 * Get proxy_caller_with_return.wasm bytes (for functions WITH return values)
 */
export function getProxyCallerWithReturnWasm(): Uint8Array {
  if (!proxyCallerWithReturnWasmCache) {
    proxyCallerWithReturnWasmCache = base64ToUint8Array(PROXY_CALLER_WITH_RETURN_WASM_BASE64);
    console.log('Decoded proxy_caller_with_return.wasm:', proxyCallerWithReturnWasmCache.length, 'bytes');

    // Verify magic bytes
    const magic = Array.from(proxyCallerWithReturnWasmCache.slice(0, 4))
      .map(b => b.toString(16).padStart(2, '0'))
      .join(' ');
    console.log('WASM magic bytes:', magic);
  }
  return proxyCallerWithReturnWasmCache;
}

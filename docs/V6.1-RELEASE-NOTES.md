# StakeVue V6.1 - Real CSPR Transfers (Not Deployed)

## Summary

V6.1 was developed to enable **real CSPR transfers** during stake/unstake operations, but could not be deployed to the frontend due to CORS restrictions when fetching user account data.

## Contract Deployed (Testnet)

```
Contract Hash: hash-d59ba3b52cbf5678f4a3e926e40758316b1119abd3cf8dbdd07300f601e42499
Contract Package Hash: da7ec3951ab01e272bd340cbd69344814755da63f0b60016f56ebd90ae10e82a
Network: casper-test
```

## What V6.1 Does

### Smart Contract Changes
- `stake(amount, source_purse)` - Accepts user's purse as parameter to receive CSPR
- `unstake(amount, dest_purse)` - Accepts user's purse as parameter to return CSPR

### Why Purse as Parameter?
The Casper VM prevents contracts from accessing user purses directly via `account::get_main_purse()`. This causes a "Forged reference" error because the contract doesn't have permission to access the URef.

**Solution**: Pass the purse as a parameter. When the user signs the transaction, the contract gains temporary access rights to the purse.

## Why Not Deployed

To pass the user's purse to the contract, the frontend needs to:
1. Query the Casper RPC to get the user's account info
2. Extract the main purse URef from the account data
3. Include it in the transaction

**Problem**: Browser CORS restrictions block direct RPC calls to `https://rpc.testnet.casperlabs.io/rpc`.

### Solutions Attempted
1. Direct RPC call - Blocked by CORS
2. Vercel serverless function proxy - Runtime configuration issues
3. CORS proxies (corsproxy.io, allorigins, cors-anywhere) - All failed or returned errors
4. CSPR.cloud API - Still had CORS issues

## Current State

The project uses **V6.0** which tracks stakes internally without real CSPR transfers:
- Users "stake" and receive stCSPR tokens (tracked in contract storage)
- No actual CSPR moves between wallets
- Simulates liquid staking for demonstration purposes

## Future Solutions

To enable V6.1 in the future:
1. **Backend server**: Deploy a Node.js/Python backend to proxy RPC calls
2. **CSPR.click native support**: If CSPR.click adds purse fetching capability
3. **Session code**: Deploy WASM that runs in user context (more complex)

## Files Modified for V6.1

- `smart-contract/src/lib.rs` - Added purse parameters
- `client/src/services/transaction.ts` - Added `fetchMainPurse()` function
- `client/api/account.js` - Vercel serverless function (attempted)

## Conclusion

V6.1 demonstrates that real CSPR transfers ARE possible on Casper with the right architecture. The contract works correctly on testnet. The limitation is purely a frontend/browser restriction that requires a backend proxy to solve.
